create table if not exists CLIENTES (
ID SERIAL primary key,
NOME VARCHAR(100) NOT NULL,
EMAIL VARCHAR(100) UNIQUE NOT NULL,
TELEFONE VARCHAR(20) UNIQUE NOT NULL,
DATA_CADASTRO DATE DEFAULT(CURRENT_DATE)
);

create table if not exists SERVICOS (
ID SERIAL primary key,
NOME VARCHAR(100) NOT NULL,
DESCRICAO TEXT NOT NULL,
PRECO DECIMAL(10,2) NOT NULL CHECK (PRECO > 0),
TIPO_SERVICO VARCHAR(50) NOT NULL,
CONSTRAINT TIPO_DE_SERVICO CHECK (TIPO_SERVICO IN ('CONSULTORIA','SUPORTE','MANUTENÇÃO'))
);

create table if not exists TECNICOS (
ID SERIAL primary key,
NOME VARCHAR(100) NOT NULL,
ESPECIALIDADE VARCHAR(50) NOT NULL,
DATA_CONTRATACAO DATE NOT NULL
);

create table if not exists CHAMADOS (
ID SERIAL primary key,
CLIENTE_ID INT NOT NULL,
TECNICO_ID INT NOT NULL,
SERVICO_ID INT NOT NULL,
DATA_CHAMADO DATE NOT NULL,
STATUS VARCHAR(20) NOT NULL,
DESCRICAO TEXT NOT NULL,
CONSTRAINT FK_CHAMADO_CLIENTE FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTES(ID) ON DELETE CASCADE,
CONSTRAINT FK_CHAMADO_TECNICO FOREIGN KEY (TECNICO_ID) REFERENCES TECNICOS(ID) ON DELETE CASCADE,
CONSTRAINT FK_CHAMADO_SERVICO FOREIGN KEY (SERVICO_ID) REFERENCES SERVICOS(ID) ON DELETE CASCADE,
CONSTRAINT TIPO_STATUS CHECK (STATUS IN ('PENDENTE', 'EM ANDAMENTO', 'FINALIZADO'))
);

create table if not exists PAGAMENTOS (
ID SERIAL primary key,
CLIENTE_ID INT NOT NULL,
CHAMADO_ID INT NOT NULL,
VALOR_PAGO DECIMAL(10,2) NOT NULL CHECK(VALOR_PAGO > 0),
CONSTRAINT FK_PAGAMENTO_CLIENTE FOREIGN KEY (CLIENTE_ID) REFERENCES CLIENTES(ID) ON DELETE CASCADE,
CONSTRAINT FK_CHAMADO FOREIGN KEY (CHAMADO_ID) REFERENCES CHAMADOS(ID) ON DELETE CASCADE
);

INSERT INTO CLIENTES (NOME, EMAIL, TELEFONE, DATA_CADASTRO)
VALUES ('JOÃO SILVA', 'JOÃO@EMAIL.COM.BR', '(11)98765-4321', '2023-01-15'),
       ('MARIA OLIVEIRA', 'MARIA@EMAIL.COM', '(21)99654-3210', '2023-02-20'),
	   ('PEDRO SOUZA', 'PEDRO@EMAIL.COM', '(31)99765-1234', '2023-03-10'),
	   ('ANA COSTA', 'ANA@EMAIL.COM', '(41)988889999', '2023-04-25'),
	   ('LUCAS ALMEIDA', 'LUCAS@EMAIL.COM', '(61)991274967', '2023-05-30');


SELECT * FROM CLIENTES;

INSERT INTO SERVICOS (NOME,DESCRICAO,PRECO,TIPO_SERVICO)
VALUES ('CONSULTORIA EM TI', 'CONSULTORIA ESPECIALIZADA EM INFRAESTRUTURA DE TI', '500.00', 'CONSULTORIA'),
       ('MANUTENCAO DE EQUIPAMENTOS', 'MANUTENÇÃO PREVENTIVA E CORRETIVA DE EQUIPAMENTOS', '300.00', 'MANUTENÇÃO'),
	   ('SUPORTE TECNICO', 'SUPORTE REMOTO E PRESENCIAL PARA EMPRESAS', '200.00', 'SUPORTE');

SELECT * FROM SERVICOS;

INSERT INTO TECNICOS (NOME,ESPECIALIDADE,DATA_CONTRATACAO)
 VALUES ('CARLOS OLIVEIRA', 'CONSULTORIA TI', '2022-10-10'),
        ('FERNANDO SOUZA', 'MANUTENÇÃO', '2021-06-15'),
		('ROBERTO COSTA', 'SUPORTE TECNICO', '2020-08-20');
		
SELECT * FROM TECNICOS;

INSERT INTO CHAMADOS (CLIENTE_ID,TECNICO_ID,SERVICO_ID,DATA_CHAMADO,STATUS,DESCRICAO)
 VALUES (1, 1, 1, '2023-06-01', 'PENDENTE', 'FIAÇÃO DA CASA QUEIMADA'),
        (2, 2, 2, '2023-07-10', 'EM ANDAMENTO', 'VAZAMENTO NA TUBULAÇÃO'),
		(3, 3, 3, '2023-08-05', 'FINALIZADO', 'REPARAÇÃO NO AR CONDICIONADO'),
		(4, 1, 2, '2023-09-20', 'PENDENTE', 'MANUTENÇÃO NO SERVIDOR'),
		(5, 2, 1, '2023-10-15', 'FINALIZADO', 'SUPORTE PARA SOFTWARE');

SELECT * FROM CHAMADOS;

ALTER TABLE PAGAMENTOS ADD COLUMN DATA_PAGAMENTO DATE NOT NULL;

ALTER TABLE PAGAMENTOS ADD COLUMN FORMA_PAGAMENTO VARCHAR(50) NOT NULL;

INSERT INTO PAGAMENTOS (CLIENTE_ID,CHAMADO_ID,VALOR_PAGO,DATA_PAGAMENTO,FORMA_PAGAMENTO)
 VALUES (1, 1, 350.00,'2023-06-15', 'CARTÃO DE CREDITO E PIX'),
        (2, 2, 450.00, '2023-07-15', 'CARTÃO DE CREDITO OU PIX'),
		(3, 3, 600.00, '2023-08-10', 'CARTAO DE CREDITO OU PIX'),
		(4, 4, 300.00, '2023-09-25', 'CARTÃO DE CREDITO OU PIX');

 SELECT * FROM PAGAMENTOS;

		SELECT NOME, EMAIL
		FROM CLIENTES;

		SELECT NOME, PRECO
		FROM SERVICOS;

		SELECT NOME, ESPECIALIDADE
		FROM TECNICOS;

		SELECT DESCRICAO, STATUS
		FROM CHAMADOS;

		SELECT VALOR_PAGO, DATA_PAGAMENTO
		FROM PAGAMENTOS;

       	SELECT CLIENTE_ID, STATUS, DESCRICAO 
        FROM CHAMADOS 
        WHERE (STATUS) = 'EM ANDAMENTO';

        SELECT NOME, ESPECIALIDADE
		FROM TECNICOS
		WHERE (ESPECIALIDADE) = 'MANUTENÇÃO';

        SELECT CLIENTE_ID, VALOR_PAGO
		FROM PAGAMENTOS;

		SELECT NOME, DESCRICAO, TIPO_SERVICO
		FROM SERVICOS;

		SELECT T.NOME AS TECNICO, S.NOME AS SERVICO
        FROM CHAMADOS C
        JOIN TECNICOS T ON C.TECNICO_ID = T.ID
        JOIN SERVICOS S ON C.SERVICO_ID = S.ID
        WHERE S.PRECO > 400;

		UPDATE SERVICOS
        SET PRECO = 350
        WHERE TIPO_SERVICO = 'MANUTENÇÃO'
        AND PRECO < 350;

	    SELECT * 
        FROM SERVICOS 
        WHERE TIPO_SERVICO = 'MANUTENÇÃO';
		
		
        DELETE FROM TECNICOS
       WHERE ID NOT IN (
       SELECT DISTINCT TECNICO_ID
       FROM CHAMADOS
       );
              



	   
